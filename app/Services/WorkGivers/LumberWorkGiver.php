<?php
namespace App\Services\WorkGivers; use App\Models\Game; use App\Models\ResourceNode; use App\Models\Task; class LumberWorkGiver { public function provideTasks(Game $game): void { $nodes = ResourceNode::where('map_id',$game->map->id)->where('type','wood')->where('amount','>',0)->get(); foreach($nodes as $n){ $exists = Task::where('game_id',$game->id)->where('task_type','chop_tree')->whereJsonContains('payload->node_id',$n->id)->exists(); if(!$exists) Task::create(['game_id'=>$game->id,'task_type'=>'chop_tree','target_id'=>$n->id,'payload'=>['x'=>$n->x,'y'=>$n->y,'node_id'=>$n->id],'priority'=>60]); } } }
