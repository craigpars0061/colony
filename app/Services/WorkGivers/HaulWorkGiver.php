<?php
namespace App\Services\WorkGivers; use App\Models\Game; use App\Models\Task; use App\Models\Item; class HaulWorkGiver { public function provideTasks(Game $game): void { $items = Item::where('game_id',$game->id)->whereNull('location_type')->get(); foreach($items as $it){ $exists = Task::where('game_id',$game->id)->where('task_type','haul')->whereJsonContains('payload->item_id',$it->id)->exists(); if(!$exists) Task::create(['game_id'=>$game->id,'task_type'=>'haul','target_id'=>$it->id,'payload'=>['x'=>$it->meta['x']??0,'y'=>$it->meta['y']??0,'item_id'=>$it->id],'priority'=>45]); } } }
